README â€” get_area (ES)
Â¿QuÃ© hace?

Calcula el Ã¡rea de pico de un pÃ©ptido en MS1 a partir de su traza monoisotÃ³pica y una ventana cromatogrÃ¡fica IX que contiene el scan ancla cur_pos. Integra la XIC monoisotÃ³pica suavizada y, si la tolerancia en ppm (ptol) indica posible solapamiento entre isÃ³topos o interferencias, aplica una correcciÃ³n de solapamientos (judgeOverlap1) usando:

el espectro MS1 del scan ancla,

una escalera isotÃ³pica de 8 lÃ­neas 
[
ğ‘€
âˆ’
7
]
â€¦
[
ğ‘€
]
[Mâˆ’7]â€¦[M] centrada en cur_mz,

y el vector teÃ³rico de probabilidades isotÃ³picas (IPV) recuperado por GetIPV() segÃºn la masa nominal floor(M).

Finalmente escala el Ã¡rea monoisotÃ³pica estimada multiplicando por sum(IPV) para aproximar el Ã¡rea total del clÃºster isotÃ³pico.

Entradas clave

c_isorts â€” tiempos cromatogrÃ¡ficos por scan (vector).

c_ref_isointens â€” matriz de XICs; la columna 2 es la monoisotÃ³pica usada aquÃ­.

nb â€” Ã­ndices de fronteras de segmentos (p. ej., cortes de regiÃ³n detectados).

cur_pos â€” Ã­ndice del scan ancla.

cur_mz, cur_ch â€” m/z objetivo y carga.

MS1_index, MS1_peaks â€” acceso al espectro MS1 por scan (Ã­ndices y tabla [m/z, intensidad]).

unitdiff â€” Î”m isotÃ³pico (Da) por paso (tÃ­picamente ~1.003355).

ptol â€” tolerancia ppm:

< 100 â‡’ activar correcciÃ³n de solapamientos (judgeOverlap1).

â‰¥ 100 â‡’ integrar por spline sin correcciÃ³n.

Pasos del algoritmo

Preprocesado de la XIC â€œmonoâ€

Usa c_ref_isointens(:,2) como traza monoisotÃ³pica.

Aplica umbral de 1.5% del mÃ¡ximo para poner a 0 el fondo muy bajo.

Si el umbral anula el punto cur_pos, revierte a la traza original sin umbral.

ElecciÃ³n de la ventana IX

Recorre los intervalos definidos por nb y expande sus extremos al primer/Ãºltimo punto no cero.

Selecciona el Ãºnico intervalo que contenga cur_pos. Si no hay, devuelve 0.

IntegraciÃ³n bÃ¡sica (sin solapamiento)

Dentro de IX, suaviza la traza mono (smooth con ventana 3).

Interpola por spline a paso 0.005 en RT y suma Ã¡rea absoluta.

CorrecciÃ³n de solapamiento (si ptol<100) â€” judgeOverlap1

Recupera el espectro MS1 del cur_pos.

Construye 8 posiciones de m/z: M-7 â€¦ M (con pasos unitdiff/charge).

Para cada posiciÃ³n, toma la intensidad mÃ¡xima dentro de Â±ptol ppm â†’ tmp_intens.

Obtiene el IPV teÃ³rico tIPV = IPV(floor(M), 1:5).

Calcula razones observadas/teÃ³ricas (r_at*) y razones adyacentes (b*), y define banderas (cc*) que verifican consistencia de la escalera.

SegÃºn patrones en esas banderas y razones, elige un conjunto de isÃ³topos de referencia c_ref_isomzs y sus Ã­ndices idx (p. ej., {M-4, M-1, M}).

Llama a GetProfiles(..., IX) para construir XICs de esos isÃ³topos, suaviza e integra cada una por spline.

Capea cada Ã¡rea basÃ¡ndose en la relaciÃ³n entre Ã¡rea del Ãºltimo isÃ³topo vs intensidad escalar en el espectro (Factor).

Si nflag=1, resta una contribuciÃ³n IPV-pesada del isotopo inmediatamente inferior.

Finalmente, realiza una sustituciÃ³n hacia atrÃ¡s con tIPV para deducir el Ã¡rea monoisotÃ³pica a partir de isÃ³topos superiores.

Escalado a clÃºster completo

Calcula fCali = sum(tIPV) y multiplica el Ã¡rea monoisotÃ³pica para aproximar el Ã¡rea del clÃºster isotÃ³pico.

Umbrales y ventanas importantes

Umbral XIC: 1.5% del mÃ¡ximo de la traza mono para anular ruido de fondo.

SelecciÃ³n IX: entre fronteras nb ajustadas al primer/Ãºltimo punto no nulo.

IntegraciÃ³n: resampleo con spline a paso 0.005 en RT.

Con/sin solapamiento: ptol < 100 â‡’ con correcciÃ³n; ptol â‰¥ 100 â‡’ sin correcciÃ³n.

Escalera isotÃ³pica: 8 lÃ­neas {Mâˆ’7,â€¦,M} con paso unitdiff/charge.

Banda de coherencia para ratios r_at* frente a IPV: 
1
/
5
,
5
1/5,5.

ElecciÃ³n de conjuntos de referencia: ramas if/elseif con combinaciones {M-6,M-4,M-2,M}, {M-6,M-3,M}, {M-4,M-2,M}, {M-3,M}, {M-2,M}, {M-1,M}, o solo {M} segÃºn el patrÃ³n.

Dependencias y contrato de datos

GetIPV() â€” tabla IPV(m_nominal, 1:5); se usa floor(M).

GetProfiles(MS1_index,MS1_peaks,c_ref_isomzs,cur_ch,ptol,1,IX) â€” devuelve RT (c_isorts) y matriz de XICs (c_ref_isointens) alineadas con IX.

smooth, spline â€” funciones de MATLAB.

MS1_index, MS1_peaks â€” deben indexar correctamente los lÃ­mites de filas por scan (columna 3 en MS1_index).

InterpretaciÃ³n del resultado

pep_area es un estimador robusto del Ã¡rea monoisotÃ³pica corregida por solapamiento y escalada para aproximar el total de isÃ³topos.

Si el espectro local es pobre o el patrÃ³n isotÃ³pico no es coherente, se usan conjuntos reducidos (p. ej., solo {M}), lo que aumenta la incertidumbre.

Si ptol es grande (â‰¥100 ppm), el mÃ©todo omite la correcciÃ³n: Ãºtil en casos de baja resoluciÃ³n o cuando el vecindario no es fiable.

Consejos prÃ¡cticos

MantÃ©n unitdiff coherente con el modelo isotÃ³pico (usar 1.003355â€¦ segÃºn el instrumento).

Verifica que c_ref_isointens(:,2) corresponda realmente a la traza mono.

Ajusta nb para cubrir segmentos cromatogrÃ¡ficos completos del pico.

Si observas Ã¡reas negativas (antes del max(â€¦,0)), revisa el capping y la selecciÃ³n de isÃ³topos de referencia.

Para estudios comparativos, fija ptol y unitdiff constantes entre muestras/runs.